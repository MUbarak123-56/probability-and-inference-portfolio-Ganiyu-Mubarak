---
title: "The Impact of Home Advantage on winning the World Series"
author: "Mubarak Ganiyu"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    number_sections: yes
    toc_depth: 3
    toc_float: yes
---

```{r global options, include = FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, cache=TRUE)
```

```{r, include = FALSE}
library(tidyverse)
```

# Introduction

In team sports, there has always been a discussion of how home advantage often gives the home team an unfair advantage.Sports like soccer has mitigated this unfair advantage by attributing more weight to the points tallied by the away team. This deliverable is focused on examining the impact of home field advantage on the Braves winning the world series.

# Method

The method used for estimating the impact of home advantage can be seen in the code chunk below. It has three different probability values for gauging the impact of home advantage. `pb` is used to showcase the non-existence of home field advantage. It is estimated to be 0.55 as shown below:$$P(B)=0.55$$
`pbh` is the probability that the Braves have a home advantage if the games was to be played in ATL. It is calculated as $$P(B)_h = P(B)*advantage$$

`pba` is the probability that the Braves win if the game was to be played in the order NYC. It is calculated as $$P(B)_a = 1 - (1 - P(B))*advantage$$
advantage stands for advantage multiplier. It has been set as 1.1 for cases in which home advantage exists and 1 if there is no home advantage.

```{r, warning = FALSE}
require(dplyr)
#install.packages("data.table")
require(data.table)
# Get all possible outcomes
calc <- function(vec, adv, p) {
  apo <- fread("https://raw.githubusercontent.com/thomasgstewart/data-science-5620-fall-2021/master/deliverables/assets/all-possible-world-series-outcomes.csv")

  # Home field indicator
  hfi <- vec #{ATL, ATL, NYC, NYC, NYC, ATL, ATL}

  # P_B
  pb <- p
  advantage_multiplier <- adv # Set = 1 for no advantage
  pbh <- p*advantage_multiplier
  pba <- 1 - (1 - p)*advantage_multiplier

  # Calculate the probability of each possible outcome
  apo[, p := NA_real_] # Initialize new column in apo to store prob
  for(i in 1:nrow(apo)) {
    prob_game <- rep(1, 7)
    for(j in 1:7) {
      p_win <- ifelse(hfi[j], pbh, pba)
      prob_game[j] <- case_when(
          apo[i,j,with=FALSE] == "W" ~ p_win
        , apo[i,j,with=FALSE] == "L" ~ 1 - p_win
        , TRUE ~ 1
        )
      }
    apo[i, p := prod(prob_game)] # Data.table syntax
    }
  # Sanity check: does sum(p) == 1?
  #apo[, sum(p)] # This is data.table notation

  # Probability of overall World Series outcomes
  as.double(apo[, sum(p), overall_outcome][1,2])
}
calc(c(1,1,0,0,0,1,1), 1.1, 0.55)
```

# Questions & Answers

1. Compute analytically the probability that the Braves win the world series when the sequence of game locations is {NYC, NYC, ATL, ATL, ATL, NYC, NYC}. (The code below computes the probability for the alternative sequence of game locations. Note: The code uses data.table syntax, which may be new to you. This is intentional, as a gentle way to introduce data.table) Calculate the probability with and without home field advantage when P(B)=0.55. What is the difference in probabilities?

**Home advantage effect**

```{r}
ha <- calc(c(0,0,1,1,1,0,0), 1.1, 0.55)
ha
```

**No home advantage**

```{r}
n_ha <- calc(c(0,0,1,1,1,0,0), 1, 0.55)
n_ha
```

2. Calculate the same probabilities as the previous question by simulation.

```{r}
set.seed(0)
p_b <- 0.55
p_ba <- 1 - (1-p_b)*1.1
p_br <- rbinom(1000,7, p_b) 
p_bar <- rbinom(1000,7, p_ba)
calc_prob <- function(p) {
  count <- 0
  for (i in p) {
    if (i >= 4) {
      count = count + 1
    }
  }
  count
}
prob_b <- calc_prob(p_br)/length(p_br)
prob_ba <- calc_prob(p_bar)/length(p_bar)
prob_b
prob_ba
```


3. What is the absolute and relative error for your simulation in the previous question?

```{r}
abs_p_br <- abs(prob_b - n_ha)
rel_p_br <- abs(prob_b - n_ha)/n_ha
abs_p_ba <- abs(prob_ba - ha)
rel_p_ba <- abs(prob_ba - ha)/ha
abs_p_br
rel_p_br
abs_p_ba
rel_p_ba
```


4. Does the difference in probabilities (with vs without home field advantage) depend on P(B)? (Generate a plot to answer this question.)

```{r}
vec <- seq(0.51,1,0.01)
pha <- c()
pnha <- c()
count <- 1
for (i in vec) {
  pha[count] <- calc(c(0,0,1,1,1,0,0), 1.1, i)
  pnha[count] <- calc(c(0,0,1,1,1,0,0), 1, i)
  count = count + 1
}
new_df <- data.frame(prob = vec, yes = pha, no = pnha)
new_df <- new_df %>% 
  mutate(diff = yes - no)
head(new_df)
```
**Plot**

```{r, fig.width = 10, fig.height = 7}
ggplot(new_df) +
  geom_point(aes(prob, diff), color = "blue") +
  theme_classic()
```

```{r}
p_b <- 0.55
p_ba <- 1 - (1-p_b)*1.1
p_br <- sample(rbinom(7,1,p_b), 1000, replace = TRUE)
p_bar <- sample(rbinom(7,1,p_ba), 1000, replace = TRUE)
```

5. Does the difference in probabilities (with vs without home field advantage) depend on the advantage factor? (The advantage factor in PBH and PBA is the 1.1 multiplier that results in a 10% increase for the home team. Generate a plot to answer this question.)

```{r}
vec <- seq(0.1,3,0.01)
adv <- c()
nadv <- c()
count <- 1
for (i in vec) {
  adv[count] <- calc(c(0,0,1,1,1,0,0), i, 0.55)
  count = count + 1
}
new_df2 <- data.frame(prob = vec, yes = adv, no = calc(c(0,0,1,1,1,0,0), 1, 0.55))
new_df2 <- new_df2 %>% 
  mutate(diff = yes - no)
head(new_df2)
```

**Plot**

```{r, fig.height=7, fig.width=10} 
ggplot(new_df2) +
  geom_point(aes(prob, diff), color = "blue") +
  theme_classic()
```

# Conclusion

